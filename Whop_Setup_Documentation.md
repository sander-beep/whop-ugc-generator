
# Experience View
Source: https://docs.whop.com/apps/app-views/experience-view

The experience view is what users see when they install your app into their Whop and click into it. This is the core functionality of your app - where users interact with your features and services.

<Frame>
    <img src="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=695a5e126942d5b709b641edd3f3a513" alt="Experience View" data-og-width="3416" width="3416" data-og-height="2118" height="2118" data-path="images/app-experience-view.jpeg" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?w=280&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=6930c5f89ecd99e0eace8272fa709631 280w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?w=560&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=2660d60a41ee5054cebb8a19fedad4b8 560w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?w=840&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=981d11df85e65a9cb1307b3de02b2388 840w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?w=1100&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=4af59f7c195cc2f3f51a3865dd5b3d5f 1100w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?w=1650&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=653a624325ea7a3b1eeb53b7995b81d1 1650w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-experience-view.jpeg?w=2500&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=fc51fda9b39a0c3ebc7c4979199e7c3d 2500w" />
</Frame>

## Configure

<Steps>
  <Step title="Go to your app's hosting settings">
    1. Go to the [developer dashboard](https://whop.com/dashboard/developer)
    2. Create a new app or select an existing one
    3. Scroll down to the **Hosting** section

    <Frame>
            <img src="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=428a4fa02ead35e8f4e3de4c368d744b" alt="App Settings" data-og-width="1976" width="1976" data-og-height="726" height="726" data-path="images/app-settings-hosting.png" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?w=280&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=cca2e1d6c5abd1fd5448c2553f157c02 280w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?w=560&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=f0306f1e7b23f0a03bab1dd671cbd5c1 560w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?w=840&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=98d7df9f594b82fba8a4e2c293a1d8f2 840w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?w=1100&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=d6c0d80f233bfc67126a9219ae5379e6 1100w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?w=1650&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=aa3dd754d75eab2ba244d642b7f3f618 1650w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-hosting.png?w=2500&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=ff85076a24ed473ed46e0aba35b0afca 2500w" />
    </Frame>
  </Step>

  <Step title="Enter your path">
    Enter your path for the experience view. The recommended default path is `/experiences/[experienceId]`.

    <Frame>
            <img src="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=09b247eb50e14ee3f0dc4bf5e903d099" alt="Experience View Path" data-og-width="1278" width="1278" data-og-height="180" height="180" data-path="images/experience-view-path.png" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?w=280&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=fc4091a2f50ab6e0287695635054031a 280w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?w=560&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=6df0f55177f6e6b5d329e9aa328c6de9 560w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?w=840&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=edef9475de4860e845a1b2e1e7b3802d 840w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?w=1100&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=67d31f35120b6c8a80f7dc6f286e627f 1100w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?w=1650&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=96f0eb3853ffd4b2ba60a08f2b11465c 1650w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/experience-view-path.png?w=2500&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=ac16450fa760c934b0a2f40902952a6b 2500w" />
    </Frame>

    * `[experienceId]` is used to provide the accessed experience ID: `/experiences/[experienceId] -> /experiences/exp_***`
    * `[restPath]` is used for deep linking to specific sections of your app: `/experiences/[experienceId]/[restPath] -> /experiences/exp_***/posts/1`
  </Step>
</Steps>

## Preview

<Steps>
  <Step title="Install your app">
    Click the install button or copy the installation link and visit it in your browser. You will be prompted to install your app into your whop.

    <Frame>
            <img src="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=9a5bbb5ab8d08cfb419aaa64b0754765" alt="Install App Button" data-og-width="872" width="872" data-og-height="87" height="87" data-path="images/app-settings-install-app-button.png" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?w=280&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=568d69af8fde6837c9ba7b94610b913c 280w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?w=560&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=a8094c257af8644a9f6929cf34508f3b 560w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?w=840&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=cad80b8792f1e952f9b6ab5172e8d02e 840w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?w=1100&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=ec6b086d527a06b925ec427042c491be 1100w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?w=1650&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=2959ba16937d45d6c23002b7cd7e9591 1650w, https://mintcdn.com/whop/10U_4RMUCDhk64co/images/app-settings-install-app-button.png?w=2500&fit=max&auto=format&n=10U_4RMUCDhk64co&q=85&s=bd377180b2973e4fba60b3b30bda2e14 2500w" />
    </Frame>

    If you've already installed your app, you can access it from your whop.

    <Frame>
            <img src="https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=3b441cbe9f4a93a4c58d9ab83a6f59f0" alt="Whop Sidebar Apps Section" data-og-width="2048" width="2048" data-og-height="1252" height="1252" data-path="images/whop-experiences.png" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?w=280&fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=f95684e2d5a4178f3c0e921e1808720c 280w, https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?w=560&fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=3d6a923e05ed7641e1d396200e65f530 560w, https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?w=840&fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=4e08784dcfe00036965caec8005a0981 840w, https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?w=1100&fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=7ebc51efee8d25323d29e8ce7b498f8e 1100w, https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?w=1650&fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=c86de5940cdfa6d0f84c2b57eb9be761 1650w, https://mintcdn.com/whop/YCN8CE8TO9oEZrci/images/whop-experiences.png?w=2500&fit=max&auto=format&n=YCN8CE8TO9oEZrci&q=85&s=7943c81b3761c8479b0e86bed1ea70c0 2500w" />
    </Frame>
  </Step>

  <Step title="Set the environment">
    1. Open the dev tools by clicking the **cog** button
    2. Set the environment to **localhost**

    <video controls className="rounded-xl" src="https://mintcdn.com/whop/wmug03bhIwuWRAcH/how-to-videos/experience-app-preview-set-localhost.mp4?fit=max&auto=format&n=wmug03bhIwuWRAcH&q=85&s=707023002211309d87f552fab95a7b5d" data-path="how-to-videos/experience-app-preview-set-localhost.mp4" />
  </Step>
</Steps>

## Validate access

Check if a user has access to an experience by using the SDK method [checkIfUserHasAccessToExperience](/sdk/api/access/check-if-user-has-access-to-experience).

```ts
  const access = await whopSdk.access.checkIfUserHasAccessToExperience({
    experienceId: "exp_***",
    userId: "user_***",
  });

  // No access
  // ^? { hasAccess: false, accessLevel: "no_access" }

  // Customer access
  // ^? { hasAccess: true, accessLevel: "customer" }

  // Admin access
  // ^? { hasAccess: true, accessLevel: "admin" }
```

See [Validate experience access](/sdk/validate-access#validate-experience-access) for more information.

## Examples

* [Next.js](https://github.com/whopio/whop-nextjs-app-template/blob/main/app/experiences/%5BexperienceId%5D/page.tsx)
* [React Native](https://github.com/whopio/whop-sdk-ts/blob/main/packages/create-react-native/template/src/views/experience-view.tsx)


# Affiliate Commissions
Source: https://docs.whop.com/apps/features/affiliate-commissions



Earn affiliate commissions by linking to a Whop's discover page:

```
https://whop.com/discover/{companyRoute}/?app={yourAppId}
```

Available query parameters:

* `?app={yourAppId}` sets your app as the affiliate
* `?productId={accessPassId}` selects the product on the discover page (optional)


# Login with Whop
Source: https://docs.whop.com/apps/features/oauth-guide

Learn how to implement Whop OAuth in a stand-alone application.

## Intro

Use Whop OAuth to authenticate users in your web or iOS app.

<Note>
  This guide only covers the basic steps to implement Whop OAuth and does not cover best practices regarding the OAuth2 protocol. It is recommended to use a library to handle the OAuth2 flow.

  We are going to release a guide on how to implement Whop OAuth with auth.js soon.
</Note>

### Step 1: Create a Whop App and obtain secrets

1. Go to the [Whop Dashboard](https://whop.com/dashboard/developer/) and create a new app or select an existing one.

2. Add a redirect uri in your apps OAuth settings

   To test your app locally you can add a redirect uri on `http://localhost:{PORT}` but it is recommended to use https for production.

3. Copy the app id and api key and set them in your environment variables.

   Keep in mind that the api key is a secret and should not be shared with anyone. The app id is public and can be shared with anyone.

   ```.env
   NEXT_PUBLIC_WHOP_APP_ID=your-app-id
   WHOP_API_KEY=your-api-key
   ```

### Step 2: Initiate the OAuth flow

#### Setup the OAuth flow

To follow this guide you will need to install the `@whop/api` package from npm:

<CodeGroup>
  ```bash pnpm
  pnpm i @whop/api
  ```

  ```bash npm
  npm i @whop/api
  ```

  ```bash yarn
  yarn add @whop/api
  ```
</CodeGroup>

Start off by creating a route that will be hit by the user when they click the `Login with Whop` button:

```ts /api/oauth/init/route.ts
import { WhopServerSdk } from "@whop/api";

const whopApi = WhopServerSdk({
  appApiKey: process.env.WHOP_API_KEY!,
  appId: process.env.NEXT_PUBLIC_WHOP_APP_ID,
});

export function GET(request: Request) {
  const url = new URL(request.url);
  const next = url.searchParams.get("next") ?? "/home";

  const { url, state } = whopApi.oauth.getAuthorizationUrl({
    // This has to be defined in the redirect uris outlined in step 1.2
    redirectUri: "http://localhost:3000/api/oauth/callback",
    // These are the authorization scopes you want to request from the user.
    scope: ["read_user"],
  });

  // The state is used to restore the `next` parameter after the user lands on the callback route.
  // Note: This is not a secure way to store the state and for demonstration purposes only.
  return Response.redirect(url, {
    headers: {
      "Set-Cookie": `oauth-state.${state}=${encodeURIComponent(
        next
      )}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=3600`,
    },
  });
}
```

<Note>
  Read more about available scopes [here](/api-reference/graphql/scopes).
</Note>

#### Adding the `Login with Whop` button

Now continue by adding a link to your app that will initiate the `Login with Whop` flow:

```html
<a href="/api/oauth/init?next=/home">Login with Whop</a>
```

Upon clicking the link the user will be redirected to the Whop OAuth page and is prompted to authorize your app.

### Step 3: Exchange the code for a token

Upon successful authorization the user will be redirected to the redirect uri you specified in the query parameters with `code` and `state` query parameters:

```ts /api/oauth/callback/route.ts
import { WhopServerSdk } from "@whop/api";

const whopApi = WhopServerSdk({
  appApiKey: process.env.WHOP_API_KEY!,
  appId: process.env.NEXT_PUBLIC_WHOP_APP_ID,
});

export function GET(request: Request) {
  const url = new URL(request.url);
  const code = url.searchParams.get("code");
  const state = url.searchParams.get("state");

  if (!code) {
    // redirect to error page
    return Response.redirect("/oauth/error?error=missing_code");
  }

  if (!state) {
    // redirect to error page
    return Response.redirect("/oauth/error?error=missing_state");
  }

  const stateCookie = request.headers
    .get("Cookie")
    ?.split(";")
    .find((cookie) => cookie.trim().startsWith(`oauth-state.${state}=`));

  if (!stateCookie) {
    // redirect to error page
    return Response.redirect("/oauth/error?error=invalid_state");
  }

  // exchange the code for a token
  const authResponse = await whopApi.oauth.exchangeCode({
    code,
    redirectUri: "http://localhost:3000/api/oauth/callback",
  });

  if (!authResponse.ok) {
    return Response.redirect("/oauth/error?error=code_exchange_failed");
  }

  const { access_token } = authResponse.tokens;

  // Restore the `next` parameter from the state cookie set in the previous step.
  const next = decodeURIComponent(stateCookie.split("=")[1]);
  const nextUrl = new URL(next, "http://localhost:3000");

  // This is an example, you should not store the plain user auth token in a cookie in production.

  // After setting the cookie you can now identify the user by reading the cookie when the user visits your website.
  return Response.redirect(nextUrl.toString(), {
    headers: {
      "Set-Cookie": `whop_access_token=${access_token}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=3600`,
    },
  });
}
```

## Implementing with authentication frameworks

### Auth.js

To implement Whop OAuth with auth.js you can use the `authJsProvider` method on the `WhopOAuth` class.

Get started by setting up the relevant auth.js distribution:

* Next.js ([Installation Guide](https://authjs.dev/getting-started/installation?framework=Next.js)) ([Example](https://github.com/whopio/whop-sdk-ts/tree/main/examples/oauth-nextjs)) via `next-auth@beta`
* SvelteKit ([Installation Guide](https://authjs.dev/getting-started/installation?framework=SvelteKit)) via `@auth/sveltekit`
* Qwik ([Installation Guide](https://authjs.dev/getting-started/installation?framework=Qwik)) via `@auth/qwik`
* Express ([Installation Guide](https://authjs.dev/getting-started/installation?framework=Express)) via `@auth/express`

Create a Whop OAuth provider and add it to your auth.js provider configuration:

```ts
const WhopProvider = whopApi.oauth.authJsProvider({
  scope: ["read_user"],
});

const authConfig = {
  providers: [WhopProvider],
  // ... rest of your auth.js configuration
};
```


# Payments and payouts
Source: https://docs.whop.com/apps/features/payments-and-payouts

Use the API to collect payment from users or payout users.

## Collecting Payments

First, create the charge on the server using the Whop API. Then you can either:

1. Open a modal in your app using the iframe SDK (recommended)
2. Redirect the user to Whop's checkout page

### 1. Create the charge on the server

> This step will create a charge on the server and return the inAppPurchase object required for the next step.

On the server, use the [chargeUser](/sdk/api/payments/charge-user) method to create a charge:

```typescript app/api/charge/route.ts
import { whopSdk } from "@/lib/whop-sdk";

export async function POST(request: Request) {
  try {
    const { userId, experienceId } = await request.json();

    const result = await whopSdk.payments.chargeUser({
      amount: 100,
      currency: "usd",
      userId: userId,
      // metadata is information that you'd like to receive later about the payment.
      metadata: {
        creditsToPurchase: 1,
        experienceId: experienceId,
      },
    });

    if (!result?.inAppPurchase) {
      throw new Error("Failed to create charge");
    }

    return Response.json(result.inAppPurchase);
  } catch (error) {
    console.error("Error creating charge:", error);
    return Response.json({ error: "Failed to create charge" }, { status: 500 });
  }
}
```

### 2. Confirm the payment on the client

> In this step the user will be prompted to confirm the previously created charge in a modal.

<Warning>
  This function requires the iFrame SDK to be initialized. See [**iFrame
  Overview**](/sdk/iframe-setup) for more information.
</Warning>

Use the iframe SDK to open a payment modal:

<CodeGroup>
  ```tsx React
  "use client";
  import { useIframeSdk } from "@whop/react";

  export default function PaymentButton({
    userId,
    experienceId,
  }: {
    userId: string;
    experienceId: string;
  }) {
    const iframeSdk = useIframeSdk();
    
    const [receiptId, setReceiptId] = useState<string>();
    const [error, setError] = useState<string>();
    
    async function handlePurchase() {
      try {
        // 1. Create charge on server
        const response = await fetch("/api/charge", {
          method: "POST",
          body: JSON.stringify({ userId, experienceId }),
        });
        
        if (response.ok) {
          const inAppPurchase = await response.json();
          // 2. Open payment modal
          const res = await iframeSdk.inAppPurchase(inAppPurchase);
          
          if (res.status === "ok") {
            setReceiptId(res.data.receipt_id);
            setError(undefined);
          } else {
            setReceiptId(undefined);
            setError(res.error);
          }
        } else {
          throw new Error("Failed to create charge");
        }
      } catch (error) {
        console.error("Purchase failed:", error);
        setError("Purchase failed");
      }
    }
    
    return <button onClick={handlePurchase}>Purchase Plan</button>;
  }
  ```

  ```tsx Vanilla JS
  import { iframeSdk } from "@/lib/iframe-sdk";

  const paymentButton = document.querySelector("button#payment-button");
  const receiptElement = document.querySelector("span#receiptContainer");
  const errorElement = document.querySelector("span#errorContainer");

  function setError(error?: string) {
    if (errorElement instanceof HTMLSpanElement) {
      errorElement.textContent = error ?? "";
    }
  }

  function setReceiptId(receiptId?: string) {
    if (receiptElement instanceof HTMLSpanElement) {
      receiptElement.textContent = receiptId ?? "";
    }
  }

  if (paymentButton instanceof HTMLButtonElement) {
    paymentButton.addEventListener(
      "click",
      async function onPaymentButtonClick() {
        const userId = this.dataset.userId;
        const experienceId = this.dataset.experienceId;
        if (!userId || !experienceId) {
          throw new Error("Missing userId or experienceId");
        }

        try {
          // 1. Create charge on server
          const response = await fetch("/api/charge", {
            method: "POST",
            body: JSON.stringify({ userId, experienceId }),
          });

          if (response.ok) {
            const inAppPurchase = await response.json();
            // 2. Open payment modal
            const res = await iframeSdk.inAppPurchase(inAppPurchase);

            if (res.status === "ok") {
              setReceiptId(res.data.receipt_id);
              setError(undefined);
            } else {
              setReceiptId(undefined);
              setError(res.error);
            }
          } else {
            throw new Error("Failed to create charge");
          }
        } catch (error) {
          console.error("Purchase failed:", error);
          setError("Purchase failed");
        }
      }
    );
  }
  ```
</CodeGroup>

### 3. Validate the payment

> After a payment is processed, you should validate it on your server using webhooks to ensure the payment was successful and update your application accordingly.

Set up a webhook route to handle payment events:

```typescript app/api/webhook/route.ts
import { makeWebhookValidator, type PaymentWebhookData } from "@whop/api";
import { after } from "next/server";

const validateWebhook = makeWebhookValidator({
  webhookSecret: process.env.WHOP_WEBHOOK_SECRET,
});

export async function POST(request: Request) {
  // Validate the webhook to ensure it's from Whop
  const webhook = await validateWebhook(request);

  // Handle the webhook event
  if (webhook.action === "payment.succeeded") {
    after(handlePaymentSucceededWebhook(webhook.data));
  }

  // Make sure to return a 2xx status code quickly. Otherwise the webhook will be retried.
  return new Response("OK", { status: 200 });
}

async function handlePaymentSucceededWebhook(data: PaymentWebhookData) {
  const { id, user_id, subtotal, amount_after_fees, metadata, ... } = data;

  // ...
}
```


